<!DOCTYPE html>
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta name="keywords" content="">
<link type="text/css" rel="stylesheet" href="themes/green/style/common.css" media="screen">
<link type="text/css" rel="stylesheet" href="themes/green/style/base.css" media="screen">
<link type="text/css" rel="stylesheet" href="themes/green/style/global.css" media="screen">
<script type="text/javascript" src="public/js/jquery.js"></script>
<script type="text/javascript" src="themes/green/js/div_window.js"></script>
<!-- <script type="text/javascript" src="themes/blue/js/PIE.js"></script> -->
<title>管理中心</title>
<script type="text/javascript">
var JS_APP = '/laugh/admin';
var JS_APPM = 'http://localhost:82/laugh';
</script>
</head>

<body>
<style type="text/css">
	body { background: none; }
</style>
<div id="control">
	<ul class="controlTop">
		<li class="controlLeftTop"></li>
		<li class="controlRightTop"></li>
	</ul>
	<div id="controlContent">
<div class="formContainer" accessStatus=1>
	<div class="formtitle"><h5>修改文档资料</h5></div>
	<form name="newform" action="/laugh/admin/index.php?s=Article/saveUpArticle" enctype="multipart/form-data" method="post" class="newform">
		<input type="hidden" name="articleid" value="7" />
		<ul class="formbody">
			<div class="shtabtitlec">
				<div class="shtabtitle shtabcurrent"><a href="javascript:;"><span>常规内容</span></a></div>
				<div class="shtabtitle"><a href="javascript:;"><span>高级内容</span></a></div>
				<div class="shtabtitle"><a href="javascript:;"><span>文档内容</span></a></div>
			</div>
			<div class="shtabcontentc">
			<div class="shtabcontent shtabcontentcurrent">
				<li class="formblock">
					<span>文档标题:</span>
					<input type="text" name="title" value="PHP实现异步操作" class="input w300" />
				</li>
				<li class="formblock">
					<span>文档标签:</span>
					<input type="text" name="tag" value="" class="input w300" /> (','号分开)
				</li>
				<li class="formblock">
					<span>文档主栏目: </span>
					<select id="select" name="columnid" style="width:230px;">
						<option value="">|-请选择栏目...</option><option value="1">&nbsp;&nbsp;|-网站首页</option><option value="2">&nbsp;&nbsp;|-新闻资讯</option><option value="3" >&nbsp;&nbsp;&nbsp;&nbsp;|-IT知识</option><option value="12" >&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|-PHP知识</option><option value="4" >&nbsp;&nbsp;&nbsp;&nbsp;|-网络知识</option><option value="5" >&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|-前端知识</option><option value="6">&nbsp;&nbsp;|-产品展示</option><option value="7">&nbsp;&nbsp;|-客户案例</option><option value="8">&nbsp;&nbsp;|-下载中心</option><option value="9">&nbsp;&nbsp;|-招贤纳士</option><option value="10">&nbsp;&nbsp;|-关于我们</option><option value="11">&nbsp;&nbsp;|-联系我们</option>
					</select>
				</li>
				<li class="formblock">
					<span>文档缩略图:</span>
					<input type="file" name="image" value="" class="input w150" style="height: 22px;" />
				</li>
				<li class="formblock">
					<span>文档来源:</span>
					<input type="text" name="source" value="" class="input w200" />
				</li>
				<li class="formblock">
					<span>作者:</span>
					<input type="text" name="author" value="admin" class="input w150" />
				</li>
				<li class="formblock">
					<span>更新时间:</span>
					<input type="text" id="dpicker0" name="publishtime" value="2013-03-26 09:51:57" onClick="WdatePicker({dateFmt:'yyyy-MM-dd HH:mm:ss'})" class="input w150" />
					<img width="16" height="22" align="absmiddle" onclick="WdatePicker({el:'dpicker0',dateFmt:'yyyy-MM-dd HH:mm:ss'})" style="cursor:pointer" src="public/plugin/My97DatePicker/skin/datePicker.gif">
				</li>
				<li class="formblock">
					<span>是否允许评论: </span>
					<div class="item_list fleft">
						<label><input type="radio" name="status" value="1" class="radio" checked />允许</label>
						<label><input type="radio" name="status" value="0" class="radio"  />禁止</label>
					</div>
				</li>
			</div>
			<div class="shtabcontent">
				<li class="formblock">
					<span>SEO标题:</span>
					<input type="text" name="seotitle" value="" class="input w300" />
				</li>
				<li class="formautoblock">
					<span>关键字:</span>
					<textarea name="keyword" rows="1" cols="47"></textarea>
				</li>
				<li class="formautoblock">
					<span>摘要内容:</span>
					<textarea name="description" rows="2" cols="47"></textarea>
				</li>
			</div>
			<div class="shtabcontent">
				<li class="formautoblock">
					<span>文档内容:</span>
					<div class="FullTextEditor">
						<textarea name="content" id="myEditor" rows="3" cols="50">&lt;p style=&quot;padding:0px;margin:0px 0px 22px;color:#000000;font-family:verdana, arial, tahoma;font-size:14px;line-height:25px;background-color:#eff4fa;&quot;&gt;&lt;span style=&quot;font-size:14px;&quot;&gt;&lt;span style=&quot;font-family:arial, helvetica, sans-serif;&quot;&gt;1.为啥PHP需要异步操作？&lt;/span&gt;&lt;/span&gt;&lt;/p&gt;&lt;p style=&quot;padding:0px;margin:0px 0px 22px;color:#000000;font-family:verdana, arial, tahoma;font-size:14px;line-height:25px;background-color:#eff4fa;&quot;&gt;&lt;span style=&quot;font-size:14px;&quot;&gt;&lt;span style=&quot;font-family:arial, helvetica, sans-serif;&quot;&gt;一般来说PHP适用的场合是web页面展示等耗时比较短的任务，如果对于比较花时间的操作如resize图片、大数据导入、批量发送EDM、SMS等，就很容易出现操作超时情况。你可以说我可以设置无限超时时间，等等你也要知道PHP有一个工作模式是fastcgi，PHP无限不超时，不代表 fastcgi相应不超时&hellip;&hellip;如果你还想说要fastcgi相应永不超时，我建议你应该跟你们的运维人员讨论去&hellip;&hellip;&lt;/span&gt;&lt;/span&gt;&lt;/p&gt;&lt;p style=&quot;padding:0px;margin:0px 0px 22px;color:#000000;font-family:verdana, arial, tahoma;font-size:14px;line-height:25px;background-color:#eff4fa;&quot;&gt;&lt;span style=&quot;font-size:14px;&quot;&gt;&lt;span style=&quot;font-family:arial, helvetica, sans-serif;&quot;&gt;这个时候异步的操作就发挥他的作用了，由于是非阻塞操作，操作会即时返回，然后在后台再慢慢干活。管你超时不超时的，我就没有在当前的进程/线程下干活。看吧是不是很美好，不过其实这也是个坑&hellip;&hellip;&lt;/span&gt;&lt;/span&gt;&lt;/p&gt;&lt;p style=&quot;padding:0px;margin:0px 0px 22px;color:#000000;font-family:verdana, arial, tahoma;font-size:14px;line-height:25px;background-color:#eff4fa;&quot;&gt;&lt;span style=&quot;font-size:14px;&quot;&gt;&lt;span style=&quot;font-family:arial, helvetica, sans-serif;&quot;&gt;2.PHP可以实现异步操作吗？&lt;/span&gt;&lt;/span&gt;&lt;/p&gt;&lt;p style=&quot;padding:0px;margin:0px 0px 22px;color:#000000;font-family:verdana, arial, tahoma;font-size:14px;line-height:25px;background-color:#eff4fa;&quot;&gt;&lt;span style=&quot;font-size:14px;&quot;&gt;&lt;span style=&quot;font-family:arial, helvetica, sans-serif;&quot;&gt;答案是肯定的，不过网上各种的纯PHP实现得就有点别扭了。socket模式、挂起进程模式、有的还直接fork进程。很好，各路神仙各显神通。如果运维人员看到的话，一定会&times;&times;&times;&times;&times;你们的，不把web server跑死才怪&hellip;&hellip;&lt;/span&gt;&lt;/span&gt;&lt;/p&gt;&lt;p style=&quot;padding:0px;margin:0px 0px 22px;color:#000000;font-family:verdana, arial, tahoma;font-size:14px;line-height:25px;background-color:#eff4fa;&quot;&gt;&lt;span style=&quot;font-size:14px;&quot;&gt;&lt;span style=&quot;font-family:arial, helvetica, sans-serif;&quot;&gt;那还有其他更好的方法去实现这个异步操作的可能么？有，现在我们只有想怎么开外挂了。查一下PECL主流的外挂方案有一堆的&times;&times;MQ（消息队列），其中有个用于任务分配的外挂进入了我们的视线&lt;a href=&quot;http://www.cnblogs.com/cocowool/archive/2011/08/18/2145144.html&quot; style=&quot;padding:0px;margin:0px;color:#626f91;text-decoration:initial;&quot; target=&quot;_blank&quot;&gt;Gearman&lt;/a&gt;(其实这家伙才是角，我就不详细介绍了，点连接看介绍)。&lt;/span&gt;&lt;/span&gt;&lt;/p&gt;&lt;p style=&quot;padding:0px;margin:0px 0px 22px;color:#000000;font-family:verdana, arial, tahoma;font-size:14px;line-height:25px;background-color:#eff4fa;&quot;&gt;&lt;span style=&quot;font-size:14px;&quot;&gt;&lt;span style=&quot;font-family:arial, helvetica, sans-serif;&quot;&gt;3.为啥选择Gearman?&lt;/span&gt;&lt;/span&gt;&lt;/p&gt;&lt;p style=&quot;padding:0px;margin:0px 0px 22px;color:#000000;font-family:verdana, arial, tahoma;font-size:14px;line-height:25px;background-color:#eff4fa;&quot;&gt;&lt;span style=&quot;font-size:14px;&quot;&gt;&lt;span style=&quot;font-family:arial, helvetica, sans-serif;&quot;&gt;别的不说，就说他的client多，支持很多语言的client，你可以使用大部分你喜欢的语言去写worker。我个人是很烦语言之争，你喜欢用神码语言写worker都随你喜欢。有数据持久化支持（就是把队列保存到数据库介质中，那故障恢复也好做），有群集支持（其实很多&times;&times;MQ都有这些功能）。 PECL上有扩展，也有纯PHP实现扩展。反正这个Gearman也活了很久了，杂七杂八的问题都基本上解决了。&lt;/span&gt;&lt;/span&gt;&lt;/p&gt;&lt;p style=&quot;padding:0px;margin:0px 0px 22px;color:#000000;font-family:verdana, arial, tahoma;font-size:14px;line-height:25px;background-color:#eff4fa;&quot;&gt;&lt;span style=&quot;font-size:14px;&quot;&gt;&lt;span style=&quot;font-family:arial, helvetica, sans-serif;&quot;&gt;4.基本思路&lt;/span&gt;&lt;/span&gt;&lt;/p&gt;&lt;p style=&quot;padding:0px;margin:0px 0px 22px;color:#000000;font-family:verdana, arial, tahoma;font-size:14px;line-height:25px;background-color:#eff4fa;&quot;&gt;&lt;span style=&quot;font-size:14px;&quot;&gt;&lt;span style=&quot;font-family:arial, helvetica, sans-serif;&quot;&gt;有了Gearman这外挂就简单多了。就是向gearman发送一个任务，把执行的任务发出去，然后等待worker去调用PHP cli去运行我们的php代码。&lt;/span&gt;&lt;/span&gt;&lt;/p&gt;&lt;p style=&quot;padding:0px;margin:0px 0px 22px;color:#000000;font-family:verdana, arial, tahoma;font-size:14px;line-height:25px;background-color:#eff4fa;&quot;&gt;&lt;span style=&quot;font-size:14px;&quot;&gt;&lt;span style=&quot;font-family:arial, helvetica, sans-serif;&quot;&gt;我就写了一下一个python的worker（别问我为啥用python，1.我会python，2.linux下不用装runtime），你可以自己根据思路写一个PHP的worker，不过嘛，本人是不太信得过PHP跑的worker。其他语言饭可以用java、node.js 或者其他语言实现一个worker试试。对用Golang写worker有兴趣的朋友可以找我。&lt;/span&gt;&lt;/span&gt;&lt;/p&gt;&lt;p style=&quot;padding:0px;margin:0px 0px 22px;color:#000000;font-family:verdana, arial, tahoma;font-size:14px;line-height:25px;background-color:#eff4fa;&quot;&gt;&lt;span style=&quot;font-size:14px;&quot;&gt;&lt;span style=&quot;font-family:arial, helvetica, sans-serif;&quot;&gt;&lt;a href=&quot;http://code.google.com/p/phpasync-for-gearman/downloads/detail?name=phpasync_worker_py.zip&amp;amp;can=2&amp;amp;q=&quot; style=&quot;padding:0px;margin:0px;color:#626f91;text-decoration:initial;&quot; target=&quot;_blank&quot;&gt;phpasync_worker_py&lt;/a&gt;&lt;/span&gt;&lt;/span&gt;&lt;/p&gt;&lt;p style=&quot;padding:0px;margin:0px 0px 22px;color:#000000;font-family:verdana, arial, tahoma;font-size:14px;line-height:25px;background-color:#eff4fa;&quot;&gt;&lt;span style=&quot;font-size:14px;&quot;&gt;&lt;span style=&quot;font-family:arial, helvetica, sans-serif;&quot;&gt;不好意思，里面是没有注释的。一个配置文件，一个py脚本。基本的功能也就是分析一下调用的参数，然后调用PHP Cli，就是那样子而已。要让py脚本跑起来请自行安装python的gearman模块。&lt;/span&gt;&lt;/span&gt;&lt;/p&gt;&lt;p style=&quot;padding:0px;margin:0px 0px 22px;color:#000000;font-family:verdana, arial, tahoma;font-size:14px;line-height:25px;background-color:#eff4fa;&quot;&gt;&lt;span style=&quot;font-size:14px;&quot;&gt;&lt;span style=&quot;font-family:arial, helvetica, sans-serif;&quot;&gt;然后到PHP的部分先上测试代码：&lt;/span&gt;&lt;/span&gt;&lt;/p&gt;&lt;ol style=&quot;margin:0px;border-width:0px;color:#000000;font-family:verdana, arial, tahoma;font-size:14px;line-height:25px;background-color:#eff4fa;padding-right:0px;padding-left:0px;&quot;&gt;&lt;li style=&quot;padding:0px;margin:0px;border-width:0px;list-style-position:outside;list-style-type:none;&quot;&gt;&lt;pre style=&quot;padding:0px;font-family:&amp;#39;courier new&amp;#39;, monospace;font-size:12px;width:650.421875px;word-wrap:break-word;word-break:break-all;background-color:#f7f7f7;margin-top:0px;&quot;&gt;&lt;span style=&quot;font-size:14px;&quot;&gt;&lt;span style=&quot;font-family:arial, helvetica, sans-serif;&quot;&gt;&amp;lt;?php &amp;nbsp;&lt;/span&gt;&lt;/span&gt;&lt;/pre&gt;&lt;/li&gt;&lt;li style=&quot;padding:0px;margin:0px;border-width:0px;list-style-position:outside;list-style-type:none;&quot;&gt;&lt;p&gt;&lt;span style=&quot;font-size:14px;&quot;&gt;&lt;span style=&quot;font-family:arial, helvetica, sans-serif;&quot;&gt;require_once &amp;#39;PHPAsyncClient.php&amp;#39;; &amp;nbsp;&lt;/span&gt;&lt;/span&gt;&lt;/p&gt;&lt;/li&gt;&lt;li style=&quot;padding:0px;margin:0px;border-width:0px;list-style-position:outside;list-style-type:none;&quot;&gt;&lt;p&gt;&lt;span style=&quot;font-size:14px;&quot;&gt;&lt;span style=&quot;font-family:arial, helvetica, sans-serif;&quot;&gt;date_default_timezone_set(&amp;#39;Asia/Shanghai&amp;#39;); &amp;nbsp;&lt;/span&gt;&lt;/span&gt;&lt;/p&gt;&lt;/li&gt;&lt;li style=&quot;padding:0px;margin:0px;border-width:0px;list-style-position:outside;list-style-type:none;&quot;&gt;&lt;p&gt; &lt;/p&gt;&lt;/li&gt;&lt;li style=&quot;padding:0px;margin:0px;border-width:0px;list-style-position:outside;list-style-type:none;&quot;&gt;&lt;p&gt;&lt;span style=&quot;font-size:14px;&quot;&gt;&lt;span style=&quot;font-family:arial, helvetica, sans-serif;&quot;&gt;class AsyncTest { &amp;nbsp;&lt;/span&gt;&lt;/span&gt;&lt;/p&gt;&lt;/li&gt;&lt;li style=&quot;padding:0px;margin:0px;border-width:0px;list-style-position:outside;list-style-type:none;&quot;&gt;&lt;p&gt; &lt;/p&gt;&lt;/li&gt;&lt;li style=&quot;padding:0px;margin:0px;border-width:0px;list-style-position:outside;list-style-type:none;&quot;&gt;&lt;p&gt;&lt;span style=&quot;font-size:14px;&quot;&gt;&lt;span style=&quot;font-family:arial, helvetica, sans-serif;&quot;&gt; &amp;nbsp; &amp;nbsp;const &lt;/span&gt;&lt;/span&gt;&lt;/p&gt;&lt;/li&gt;&lt;li style=&quot;padding:0px;margin:0px;border-width:0px;list-style-position:outside;list-style-type:none;&quot;&gt;&lt;p&gt;&lt;span style=&quot;font-size:14px;&quot;&gt;&lt;span style=&quot;font-family:arial, helvetica, sans-serif;&quot;&gt; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;LOG_FILE = &amp;#39;/debug.log&amp;#39;; &amp;nbsp;&lt;/span&gt;&lt;/span&gt;&lt;/p&gt;&lt;/li&gt;&lt;li style=&quot;padding:0px;margin:0px;border-width:0px;list-style-position:outside;list-style-type:none;&quot;&gt;&lt;p&gt; &lt;/p&gt;&lt;/li&gt;&lt;li style=&quot;padding:0px;margin:0px;border-width:0px;list-style-position:outside;list-style-type:none;&quot;&gt;&lt;p&gt;&lt;span style=&quot;font-size:14px;&quot;&gt;&lt;span style=&quot;font-family:arial, helvetica, sans-serif;&quot;&gt; &amp;nbsp; &amp;nbsp;static public function run() { &amp;nbsp;&lt;/span&gt;&lt;/span&gt;&lt;/p&gt;&lt;/li&gt;&lt;li style=&quot;padding:0px;margin:0px;border-width:0px;list-style-position:outside;list-style-type:none;&quot;&gt;&lt;p&gt;&lt;span style=&quot;font-size:14px;&quot;&gt;&lt;span style=&quot;font-family:arial, helvetica, sans-serif;&quot;&gt; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;if (PHPAsyncClient::in_callback(__FILE__)) { &amp;nbsp;&lt;/span&gt;&lt;/span&gt;&lt;/p&gt;&lt;/li&gt;&lt;li style=&quot;padding:0px;margin:0px;border-width:0px;list-style-position:outside;list-style-type:none;&quot;&gt;&lt;p&gt;&lt;span style=&quot;font-size:14px;&quot;&gt;&lt;span style=&quot;font-family:arial, helvetica, sans-serif;&quot;&gt; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;self::log(&amp;#39;php Async callback&amp;#39;); &amp;nbsp;&lt;/span&gt;&lt;/span&gt;&lt;/p&gt;&lt;/li&gt;&lt;li style=&quot;padding:0px;margin:0px;border-width:0px;list-style-position:outside;list-style-type:none;&quot;&gt;&lt;p&gt;&lt;span style=&quot;font-size:14px;&quot;&gt;&lt;span style=&quot;font-family:arial, helvetica, sans-serif;&quot;&gt; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;PHPAsyncClient::parse(); &amp;nbsp;&lt;/span&gt;&lt;/span&gt;&lt;/p&gt;&lt;/li&gt;&lt;li style=&quot;padding:0px;margin:0px;border-width:0px;list-style-position:outside;list-style-type:none;&quot;&gt;&lt;p&gt;&lt;span style=&quot;font-size:14px;&quot;&gt;&lt;span style=&quot;font-family:arial, helvetica, sans-serif;&quot;&gt; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;return; &amp;nbsp;&lt;/span&gt;&lt;/span&gt;&lt;/p&gt;&lt;/li&gt;&lt;li style=&quot;padding:0px;margin:0px;border-width:0px;list-style-position:outside;list-style-type:none;&quot;&gt;&lt;p&gt;&lt;span style=&quot;font-size:14px;&quot;&gt;&lt;span style=&quot;font-family:arial, helvetica, sans-serif;&quot;&gt; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;} &amp;nbsp;&lt;/span&gt;&lt;/span&gt;&lt;/p&gt;&lt;/li&gt;&lt;li style=&quot;padding:0px;margin:0px;border-width:0px;list-style-position:outside;list-style-type:none;&quot;&gt;&lt;p&gt;&lt;span style=&quot;font-size:14px;&quot;&gt;&lt;span style=&quot;font-family:arial, helvetica, sans-serif;&quot;&gt; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;if (PHPAsyncClient::is_main(__FILE__)) { &amp;nbsp;&lt;/span&gt;&lt;/span&gt;&lt;/p&gt;&lt;/li&gt;&lt;li style=&quot;padding:0px;margin:0px;border-width:0px;list-style-position:outside;list-style-type:none;&quot;&gt;&lt;p&gt;&lt;span style=&quot;font-size:14px;&quot;&gt;&lt;span style=&quot;font-family:arial, helvetica, sans-serif;&quot;&gt; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;self::log(&amp;#39;main run&amp;#39;); &amp;nbsp;&lt;/span&gt;&lt;/span&gt;&lt;/p&gt;&lt;/li&gt;&lt;li style=&quot;padding:0px;margin:0px;border-width:0px;list-style-position:outside;list-style-type:none;&quot;&gt;&lt;p&gt;&lt;span style=&quot;font-size:14px;&quot;&gt;&lt;span style=&quot;font-family:arial, helvetica, sans-serif;&quot;&gt; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;$async_call = PHPAsyncClient::getInstance(); &amp;nbsp;&lt;/span&gt;&lt;/span&gt;&lt;/p&gt;&lt;/li&gt;&lt;li style=&quot;padding:0px;margin:0px;border-width:0px;list-style-position:outside;list-style-type:none;&quot;&gt;&lt;p&gt;&lt;span style=&quot;font-size:14px;&quot;&gt;&lt;span style=&quot;font-family:arial, helvetica, sans-serif;&quot;&gt; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;$async_call-&amp;gt;AsyncCall(&amp;#39;AsyncTest&amp;#39;, &amp;#39;callback&amp;#39;, array( &amp;nbsp;&lt;/span&gt;&lt;/span&gt;&lt;/p&gt;&lt;/li&gt;&lt;li style=&quot;padding:0px;margin:0px;border-width:0px;list-style-position:outside;list-style-type:none;&quot;&gt;&lt;p&gt;&lt;span style=&quot;font-size:14px;&quot;&gt;&lt;span style=&quot;font-family:arial, helvetica, sans-serif;&quot;&gt; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;&amp;#39;content&amp;#39; =&amp;gt; &amp;#39;Hello World!!!&amp;#39;, &amp;nbsp;&lt;/span&gt;&lt;/span&gt;&lt;/p&gt;&lt;/li&gt;&lt;li style=&quot;padding:0px;margin:0px;border-width:0px;list-style-position:outside;list-style-type:none;&quot;&gt;&lt;p&gt;&lt;span style=&quot;font-size:14px;&quot;&gt;&lt;span style=&quot;font-family:arial, helvetica, sans-serif;&quot;&gt; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;), array( &amp;nbsp;&lt;/span&gt;&lt;/span&gt;&lt;/p&gt;&lt;/li&gt;&lt;li style=&quot;padding:0px;margin:0px;border-width:0px;list-style-position:outside;list-style-type:none;&quot;&gt;&lt;p&gt;&lt;span style=&quot;font-size:14px;&quot;&gt;&lt;span style=&quot;font-family:arial, helvetica, sans-serif;&quot;&gt; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;&amp;#39;class&amp;#39; =&amp;gt; &amp;#39;AsyncTest&amp;#39;, &amp;nbsp;&lt;/span&gt;&lt;/span&gt;&lt;/p&gt;&lt;/li&gt;&lt;li style=&quot;padding:0px;margin:0px;border-width:0px;list-style-position:outside;list-style-type:none;&quot;&gt;&lt;p&gt;&lt;span style=&quot;font-size:14px;&quot;&gt;&lt;span style=&quot;font-family:arial, helvetica, sans-serif;&quot;&gt; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;&amp;#39;method&amp;#39; =&amp;gt; &amp;#39;callback&amp;#39;, &amp;nbsp;&lt;/span&gt;&lt;/span&gt;&lt;/p&gt;&lt;/li&gt;&lt;li style=&quot;padding:0px;margin:0px;border-width:0px;list-style-position:outside;list-style-type:none;&quot;&gt;&lt;p&gt;&lt;span style=&quot;font-size:14px;&quot;&gt;&lt;span style=&quot;font-family:arial, helvetica, sans-serif;&quot;&gt; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;&amp;#39;params&amp;#39; =&amp;gt; array( &amp;nbsp;&lt;/span&gt;&lt;/span&gt;&lt;/p&gt;&lt;/li&gt;&lt;li style=&quot;padding:0px;margin:0px;border-width:0px;list-style-position:outside;list-style-type:none;&quot;&gt;&lt;p&gt;&lt;span style=&quot;font-size:14px;&quot;&gt;&lt;span style=&quot;font-family:arial, helvetica, sans-serif;&quot;&gt; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;&amp;#39;content&amp;#39; =&amp;gt; &amp;#39;Hello Callback!&amp;#39;, &amp;nbsp;&lt;/span&gt;&lt;/span&gt;&lt;/p&gt;&lt;/li&gt;&lt;li style=&quot;padding:0px;margin:0px;border-width:0px;list-style-position:outside;list-style-type:none;&quot;&gt;&lt;p&gt;&lt;span style=&quot;font-size:14px;&quot;&gt;&lt;span style=&quot;font-family:arial, helvetica, sans-serif;&quot;&gt; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;), &amp;nbsp;&lt;/span&gt;&lt;/span&gt;&lt;/p&gt;&lt;/li&gt;&lt;li style=&quot;padding:0px;margin:0px;border-width:0px;list-style-position:outside;list-style-type:none;&quot;&gt;&lt;p&gt;&lt;span style=&quot;font-size:14px;&quot;&gt;&lt;span style=&quot;font-family:arial, helvetica, sans-serif;&quot;&gt; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;), __FILE__); &amp;nbsp;&lt;/span&gt;&lt;/span&gt;&lt;/p&gt;&lt;/li&gt;&lt;li style=&quot;padding:0px;margin:0px;border-width:0px;list-style-position:outside;list-style-type:none;&quot;&gt;&lt;p&gt;&lt;span style=&quot;font-size:14px;&quot;&gt;&lt;span style=&quot;font-family:arial, helvetica, sans-serif;&quot;&gt; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;return; &amp;nbsp;&lt;/span&gt;&lt;/span&gt;&lt;/p&gt;&lt;/li&gt;&lt;li style=&quot;padding:0px;margin:0px;border-width:0px;list-style-position:outside;list-style-type:none;&quot;&gt;&lt;p&gt;&lt;span style=&quot;font-size:14px;&quot;&gt;&lt;span style=&quot;font-family:arial, helvetica, sans-serif;&quot;&gt; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;} &amp;nbsp;&lt;/span&gt;&lt;/span&gt;&lt;/p&gt;&lt;/li&gt;&lt;li style=&quot;padding:0px;margin:0px;border-width:0px;list-style-position:outside;list-style-type:none;&quot;&gt;&lt;p&gt;&lt;span style=&quot;font-size:14px;&quot;&gt;&lt;span style=&quot;font-family:arial, helvetica, sans-serif;&quot;&gt; &amp;nbsp; &amp;nbsp;} &amp;nbsp;&lt;/span&gt;&lt;/span&gt;&lt;/p&gt;&lt;/li&gt;&lt;li style=&quot;padding:0px;margin:0px;border-width:0px;list-style-position:outside;list-style-type:none;&quot;&gt;&lt;p&gt; &lt;/p&gt;&lt;/li&gt;&lt;li style=&quot;padding:0px;margin:0px;border-width:0px;list-style-position:outside;list-style-type:none;&quot;&gt;&lt;p&gt;&lt;span style=&quot;font-size:14px;&quot;&gt;&lt;span style=&quot;font-family:arial, helvetica, sans-serif;&quot;&gt; &amp;nbsp; &amp;nbsp;static public function callback($args) { &amp;nbsp;&lt;/span&gt;&lt;/span&gt;&lt;/p&gt;&lt;/li&gt;&lt;li style=&quot;padding:0px;margin:0px;border-width:0px;list-style-position:outside;list-style-type:none;&quot;&gt;&lt;p&gt;&lt;span style=&quot;font-size:14px;&quot;&gt;&lt;span style=&quot;font-family:arial, helvetica, sans-serif;&quot;&gt; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;self::log(&amp;#39;AsyncTest callback run&amp;#39;); &amp;nbsp;&lt;/span&gt;&lt;/span&gt;&lt;/p&gt;&lt;/li&gt;&lt;li style=&quot;padding:0px;margin:0px;border-width:0px;list-style-position:outside;list-style-type:none;&quot;&gt;&lt;p&gt;&lt;span style=&quot;font-size:14px;&quot;&gt;&lt;span style=&quot;font-family:arial, helvetica, sans-serif;&quot;&gt; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;self::log(&amp;#39;AsyncTest callback args:&amp;#39;.print_r($args, true)); &amp;nbsp;&lt;/span&gt;&lt;/span&gt;&lt;/p&gt;&lt;/li&gt;&lt;li style=&quot;padding:0px;margin:0px;border-width:0px;list-style-position:outside;list-style-type:none;&quot;&gt;&lt;p&gt;&lt;span style=&quot;font-size:14px;&quot;&gt;&lt;span style=&quot;font-family:arial, helvetica, sans-serif;&quot;&gt; &amp;nbsp; &amp;nbsp;} &amp;nbsp;&lt;/span&gt;&lt;/span&gt;&lt;/p&gt;&lt;/li&gt;&lt;li style=&quot;padding:0px;margin:0px;border-width:0px;list-style-position:outside;list-style-type:none;&quot;&gt;&lt;p&gt; &lt;/p&gt;&lt;/li&gt;&lt;li style=&quot;padding:0px;margin:0px;border-width:0px;list-style-position:outside;list-style-type:none;&quot;&gt;&lt;p&gt;&lt;span style=&quot;font-size:14px;&quot;&gt;&lt;span style=&quot;font-family:arial, helvetica, sans-serif;&quot;&gt; &amp;nbsp; &amp;nbsp;static public function log($content) { &amp;nbsp;&lt;/span&gt;&lt;/span&gt;&lt;/p&gt;&lt;/li&gt;&lt;li style=&quot;padding:0px;margin:0px;border-width:0px;list-style-position:outside;list-style-type:none;&quot;&gt;&lt;p&gt;&lt;span style=&quot;font-size:14px;&quot;&gt;&lt;span style=&quot;font-family:arial, helvetica, sans-serif;&quot;&gt; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;$fullname = dirname(__FILE__).self::LOG_FILE; &amp;nbsp;&lt;/span&gt;&lt;/span&gt;&lt;/p&gt;&lt;/li&gt;&lt;li style=&quot;padding:0px;margin:0px;border-width:0px;list-style-position:outside;list-style-type:none;&quot;&gt;&lt;p&gt;&lt;span style=&quot;font-size:14px;&quot;&gt;&lt;span style=&quot;font-family:arial, helvetica, sans-serif;&quot;&gt; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;$content = date(&amp;#39;[Y-m-d H:i:s]&amp;#39;).$content.&amp;quot;&amp;quot;; &amp;nbsp;&lt;/span&gt;&lt;/span&gt;&lt;/p&gt;&lt;/li&gt;&lt;li style=&quot;padding:0px;margin:0px;border-width:0px;list-style-position:outside;list-style-type:none;&quot;&gt;&lt;p&gt;&lt;span style=&quot;font-size:14px;&quot;&gt;&lt;span style=&quot;font-family:arial, helvetica, sans-serif;&quot;&gt; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;file_put_contents($fullname, $content, FILE_APPEND); &amp;nbsp;&lt;/span&gt;&lt;/span&gt;&lt;/p&gt;&lt;/li&gt;&lt;li style=&quot;padding:0px;margin:0px;border-width:0px;list-style-position:outside;list-style-type:none;&quot;&gt;&lt;p&gt;&lt;span style=&quot;font-size:14px;&quot;&gt;&lt;span style=&quot;font-family:arial, helvetica, sans-serif;&quot;&gt; &amp;nbsp; &amp;nbsp;} &amp;nbsp;&lt;/span&gt;&lt;/span&gt;&lt;/p&gt;&lt;/li&gt;&lt;li style=&quot;padding:0px;margin:0px;border-width:0px;list-style-position:outside;list-style-type:none;&quot;&gt;&lt;p&gt;&lt;span style=&quot;font-size:14px;&quot;&gt;&lt;span style=&quot;font-family:arial, helvetica, sans-serif;&quot;&gt;} &amp;nbsp;&lt;/span&gt;&lt;/span&gt;&lt;/p&gt;&lt;/li&gt;&lt;li style=&quot;padding:0px;margin:0px;border-width:0px;list-style-position:outside;list-style-type:none;&quot;&gt;&lt;p&gt; &lt;/p&gt;&lt;/li&gt;&lt;li style=&quot;padding:0px;margin:0px;border-width:0px;list-style-position:outside;list-style-type:none;&quot;&gt;&lt;p&gt;&lt;span style=&quot;font-size:14px;&quot;&gt;&lt;span style=&quot;font-family:arial, helvetica, sans-serif;&quot;&gt;AsyncTest::run(); &lt;/span&gt;&lt;/span&gt;&lt;/p&gt;&lt;/li&gt;&lt;/ol&gt;&lt;p style=&quot;padding:0px;margin:0px 0px 22px;color:#000000;font-family:verdana, arial, tahoma;font-size:14px;line-height:25px;background-color:#eff4fa;&quot;&gt;&lt;span style=&quot;font-size:14px;&quot;&gt;&lt;span style=&quot;font-family:arial, helvetica, sans-serif;&quot;&gt;就3个静态方法，一个是用于调试的log方法，其他都是字面意思。这个例子是对这种调用方式有个初步印象。然后直接上PHP的所有源码：&lt;/span&gt;&lt;/span&gt;&lt;/p&gt;&lt;p style=&quot;padding:0px;margin:0px 0px 22px;color:#000000;font-family:verdana, arial, tahoma;font-size:14px;line-height:25px;background-color:#eff4fa;&quot;&gt;&lt;span style=&quot;font-size:14px;&quot;&gt;&lt;span style=&quot;font-family:arial, helvetica, sans-serif;&quot;&gt;&lt;a href=&quot;http://code.google.com/p/phpasync-for-gearman/downloads/detail?name=php_async.zip&amp;amp;can=2&amp;amp;q=&quot; style=&quot;padding:0px;margin:0px;color:#626f91;text-decoration:initial;&quot; target=&quot;_blank&quot;&gt;php_async.zip&lt;/a&gt;&lt;/span&gt;&lt;/span&gt;&lt;/p&gt;&lt;p style=&quot;padding:0px;margin:0px 0px 22px;color:#000000;font-family:verdana, arial, tahoma;font-size:14px;line-height:25px;background-color:#eff4fa;&quot;&gt;&lt;span style=&quot;font-size:14px;&quot;&gt;&lt;span style=&quot;font-family:arial, helvetica, sans-serif;&quot;&gt;然后应该会有很多人会说，win下安装不了gearman&hellip;&hellip;所以我把java版的gearman server也放上去吧。&lt;/span&gt;&lt;/span&gt;&lt;/p&gt;&lt;p style=&quot;padding:0px;margin:0px 0px 22px;color:#000000;font-family:verdana, arial, tahoma;font-size:14px;line-height:25px;background-color:#eff4fa;&quot;&gt;&lt;span style=&quot;font-size:14px;&quot;&gt;&lt;span style=&quot;font-family:arial, helvetica, sans-serif;&quot;&gt;&lt;a href=&quot;http://code.google.com/p/phpasync-for-gearman/downloads/detail?name=java-gearman-service-0.6.6.zip&amp;amp;can=2&amp;amp;q=&quot; style=&quot;padding:0px;margin:0px;color:#626f91;text-decoration:initial;&quot; target=&quot;_blank&quot;&gt;java-gearman-service-0.6.6.zip&lt;/a&gt;&lt;/span&gt;&lt;/span&gt;&lt;/p&gt;&lt;p style=&quot;padding:0px;margin:0px 0px 22px;color:#000000;font-family:verdana, arial, tahoma;font-size:14px;line-height:25px;background-color:#eff4fa;&quot;&gt;&lt;span style=&quot;font-size:14px;&quot;&gt;&lt;span style=&quot;font-family:arial, helvetica, sans-serif;&quot;&gt;5.结论&lt;/span&gt;&lt;/span&gt;&lt;/p&gt;&lt;p style=&quot;padding:0px;margin:0px 0px 22px;color:#000000;font-family:verdana, arial, tahoma;font-size:14px;line-height:25px;background-color:#eff4fa;&quot;&gt;&lt;span style=&quot;font-size:14px;&quot;&gt;&lt;span style=&quot;font-family:arial, helvetica, sans-serif;&quot;&gt;经过以上配置犀牛一样大的家伙后（要装一个Gearman，还要跑个Py脚本），我们基本上就使PHP拥有了异步调用功能，当然其中还有一个状态维护神马的要自己去实现。所以发现，其实这个方案不咋样，太复杂了。还是使用一些web service的方式去做web callback会好点（问题是web callback一样会超时&hellip;&hellip;），这个请留意后续。&lt;/span&gt;&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;br /&gt;&lt;/p&gt;</textarea>
					</div>
				</li>
			</div>
			<li class="formblock bordernone">
				<input type="submit" name="subut" class="button btngreen2" value="修改" />
			</li>
		</ul>
	</form>
</div>
<script src="public/plugin/UEditor/editor_config.js" type="text/javascript"></script>
<script src="public/plugin/UEditor/editor_all_min.js" type="text/javascript"></script>
<script src="public/plugin/My97DatePicker/WdatePicker.js" type="text/javascript"></script>
<script type="text/javascript">
    UE.getEditor('myEditor',{
    	initialFrameWidth: 900,
    	initialFrameHeight: 320
    });
    $("form[name=newform]").submit(function(){
    	var title = $(this).find("input[name=title]").val();
    	if (!title) {
    		alert("请填写文档标题!");
    		return false;
    	}
    	var columnid = $(this).find("select[name=columnid]").val();
    	if (!columnid) {
    		alert("请选择文档所在主栏目!");
    		return false;
    	}
    });
    $("select[name=columnid]").find("option").each(function (){
    	if ($(this).val()=="12") $(this).attr("selected",true);
    });
</script>
    </div>
    <ul class="controlBottom">
		<li class="controlLeftBottom"></li>
		<li class="controlRightBottom"></li>
	</ul>
</div>
</body>
<script type="text/javascript" src="themes/green/js/jquery.corner.js"></script>
<script type="text/javascript" src="themes/green/js/public.js"></script>
<script type="text/javascript" src="themes/green/js/common.js"></script>
<script type="text/javascript" src="themes/green/js/ajax.js"></script>
<script type="text/javascript" src="public/js/jquery.idTabs.min.js"></script>
</html>